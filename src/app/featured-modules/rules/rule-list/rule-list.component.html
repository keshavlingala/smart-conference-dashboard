<h1>RULES</h1>

<div class="d-flex align-items-start justify-content-between flex-wrap">
  <button mat-raised-button style="background-color: #79A831; color: white;" routerLink="add">Add Rule</button>
  <span class="flex-fill"></span>
  <div class="position-relative">
    <input (keyup)="filterSearch(searchInput.value)" type="text" #searchInput placeholder="Search by any parameter"
           class="p-2 pr-4 rounded" style="border: none; outline: none;">
    <mat-icon class="position-absolute text-secondary"
              style="width: auto; height: auto; top: 50%; right: 0; transform: translateY(-50%);">search
    </mat-icon>
  </div>
</div>
<div *ngIf="!rule_lists" class="row justify-content-center align-items-center mb-auto">
  <mat-spinner></mat-spinner>
</div>
<div class="row mt-3">
  <div class="col-12 col-sm-6 col-md-6 col-lg-4 col-xl-3 mb-2 pr-4" *ngFor="let device of (shownData | async)">
    <mat-card style="padding: 10px">
      <div class="d-flex align-items-center">
        <h3 style="margin: 0;color: #fb7e6e">{{device.name}}</h3>
        <span class="flex-fill"></span>
        <mat-chip-list>
          <mat-chip selected
                    style="background-color: rgba(234,82,222,0.68);padding: 6px;font-size: smaller;color: #7d2e90;">
            {{device.rules.length}} rules
          </mat-chip>
        </mat-chip-list>
      </div>
      <div style="font-size: 13px" class="d-flex flex-column" *ngFor="let rule of device.rules.slice(0,2);let i=index">
        <span>{{rule.name}}</span>
        <span>{{rule.action.name}}</span>
        <span style="font-size: 0.7rem;color: gray;">{{ rule.createdDate}}</span>
        <hr *ngIf="i==0" style="margin-top: 2px;margin-bottom: 2px;">
      </div>
      <div style="color: #7589df;font-size: smaller;" class="text-right">
        <span (click)="popRules(device)" class="pointer">View More Rules</span>
      </div>
    </mat-card>
  </div>
</div>
<ng-template #noData>
  <div class="text-center mt-2 ">
    <h3>{{searchInput.value ? 'No Results found for the search Key' : 'Loading'}}</h3>
  </div>
</ng-template>
<div *ngIf="totalSize else noData" class="d-flex justify-content-center position-relative align-items-center">
  <span class="position-absolute p-1 mt-5 mt-md-0" style="left: 0">
    Viewing {{
    ((selectedIndex + 1) * pageSize - pageSize + 1) + ' - ' + min((selectedIndex + 1) * pageSize, totalSize) + ' of ' + totalSize
    }}
  </span>
  <div *ngIf="selectedIndex>0" (click)="onPageChange(selectedIndex-1)" class="page-button">{{"<"}}</div>
  <div (click)="onPageChange(i)" [ngClass]="{'active-page':selectedIndex===i}" class="page-button"
       *ngFor="let page of pages;let i = index">
    {{i + 1}}
  </div>
  <div *ngIf="selectedIndex<pages.length-1" (click)="onPageChange(selectedIndex+1)" class="page-button">{{">"}}</div>
</div>

